//= require jquery
//= require jquery_ujs
//= require turbolinks
var entries_filled = { user_name: false, first_name: false, last_name: false, password: false };
var menu_out = false;
var details_menu_out = false;
var settings_dropdown_pos = 0;
var disabled_link = false;

// Entry setter, helper function for the monitor_signup_entries() function and the monitor_login_entries() funciton.
function permit_entry(reporter) {
    switch (reporter) {
        case 'user_name':
            entries_filled.user_name = true;
            break;
        case 'first_name':
            entries_filled.first_name = true;
            break;
        case 'last_name':
            entries_filled.last_name = true;
            break;
        case 'password':
            entries_filled.password = true;
            break;
    };
};
function monitor_signup_entries(inputObject, reporter, buttonObject, buttonShroud) {
    // Check if input field has text in it and reflect that in the reporter(beign one of the entries_filled values)
    if ($(inputObject).val() != '') {
        permit_entry(reporter);
    };
    // If fields are filled, allow submission
    if (entries_filled.user_name && entries_filled.password && entries_filled.first_name && entries_filled.last_name) {
        $(buttonShroud).css('display', 'none');
        $(buttonObject).removeClass('disabled').addClass('enabled');
    }
    else {
        $(buttonShroud).css('display', 'block');
        $(buttonObject).removeClass('enabled').addClass('disabled');
    };
};
function monitor_login_entries(inputObject, reporter, buttonObject, buttonShroud) {
    if ($(inputObject).val() != '') {
        permit_entry(reporter);
    } else {
        if (inputObject) {
            reporter = false;
        };
    };
    if (entries_filled.user_name && entries_filled.password) {
        $(buttonShroud).css('display', 'none');
        $(buttonObject).removeClass('disabled').addClass('enabled');
    }
    else {
        $(buttonShroud).css('display', 'block');
        $(buttonObject).removeClass('enabled').addClass('disabled');
    };
};

// Simple function to adjust the predetermined positioning of the
function position_settings_dropdown() {
    settings_dropdown_pos = parseInt($('#menu').css('marginLeft')) + parseInt($('#menu').css('marginRight')) + parseInt($('#settings').css('marginLeft')) + 50 - 98;
};

$(document).ready(function() {
    // Presets
    position_settings_dropdown();
    $('.checkbox-ripple').css('transform', 'scale(0)');
    $('#settings-dropdown-arrow').css('transform', 'translateX(-22px)')
    // Menu mechanics
    $('#menu').click(function(event) {
        event.stopPropagation();
        $('html').click(function() {
            $('menu').animate({'margin-left': '-335px'}, 200);
        });
        $('menu').animate({'margin-left': '0'}, 200);
    });
    $('menu').click(function(event) {
        event.stopPropagation();
    });
    // Window close mechanics
    $('#close').click(function() {
        $('#closing-shroud').addClass('pressed');
        setTimeout(function () {
            // If forum has been closed, empty it's data
            $('#user_user_name').val("");
            $('#user_password').val("");
            $('#user_first_name').val("");
            $('#user_last_name').val("");

            $('#signup-forum').css('display', 'none');
        }, 120);
    });
    $('#close-login').click(function() {
        $('#closing-login-shroud').addClass('pressed');
        setTimeout(function() {
            // Only empty user_name entry data, since the password entry can't be accessed
            $('#user_name').val("");

            $('#login-forum').css('display', 'none');
        }, 120);
    });
    // Link ckicking mechanics
    $('#signup-link').click(function() {
        if ($('#login-link em').hasClass('link-disabled')) {
            disabled_link = true;
        } else {
            disabled_link = false;
        };
        if (!disabled_link) {
            // If the signup field has been opened, make sure entry data detectors are preset to false
            entries_filled.user_name = false;
            entries_filled.password = false;
            entries_filled.first_name = false;
            entries_filled.last_name = false;

            $('#signup-forum').css('height', '0').css('display', 'block');
            $('#signup-forum').animate({'height': '370px'}, 65)
            $('menu').animate({'margin-left': '-335px'}, 200);
        };
    });
    $('#login-link').click(function() {
        if ($('#signup-link em').hasClass('link-disabled')) {
            disabled_link = true;
        } else {
            disabled_link = false;
        };
        if (!disabled_link) {
            // If the signup field has been opened, make sure entry data detectors are preset to false
            entries_filled.user_name = false;
            entries_filled.password = false;

            $('#login-forum').css('height', '0').css('display', 'block')
            $('#login-forum').animate({'height': '300px'}, 65);
            $('menu').animate({'margin-left': '-335px'}, 200);
        };
    });
    // Forum entry enforcement aggragators, envoking enforcement functions
        $('#user_user_name').keyup(function() {
            monitor_signup_entries('#messenger_user_name', 'user_name', '#signup-button', '#signup-shroud');
        });
        $('#user_password').keyup(function() {
            monitor_signup_entries('#messenger_password', 'password', '#signup-button', '#signup-shroud');
        });
        $('#user_first_name').keyup(function() {
            monitor_signup_entries('#messenger_first_name', 'first_name', '#signup-button', '#signup-shroud');
        });
        $('#user_last_name').keyup(function() {
            monitor_signup_entries('#messenger_last_name', 'last_name', '#signup-button', '#signup-shroud');
        });
        $('#user_name').keyup(function() {
            monitor_login_entries('#user_name', 'user_name', '#login-button', '#login-shroud');
        });
        $('#password').keyup(function() {
            monitor_login_entries(null, 'password', '#login-button', '#login-shroud');
        });
    // Settings button & menu mechanics
    $('#settings').click(function(event) {
        position_settings_dropdown();
        $('#settings-dropdown').css('left', settings_dropdown_pos + 'px');
        $('#settings-dropdown').addClass('revealed').css('display', 'block').removeClass('hidden');
        setTimeout(function () {
            $('.settings-index').css('display', 'block');
            $('.settings-divider').css('display', 'block');
        }, 400);
        event.stopPropagation();
        $('html').click(function() {
            $('#settings-dropdown').removeClass('revealed').addClass('hidden');
        });
    });
    $('#settings-dropdown').click(function(event) {
        event.stopPropagation();
    });
    // About menu mechanics
    $('#about').click(function() {
        if (!details_menu_out) {
            $('#details-container').animate({'left': '100%'}, 200);
            details_menu_out = true;
        } else {
            $('#details-container').animate({'left': '120%'}, 200);
            details_menu_out = false;
        };
    });
});
